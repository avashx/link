<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LinkrtGOD - LinkedIn Analytics</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      color: #37352f;
      font-size: 14px;
      line-height: 1.5;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .header {
      text-align: left;
      margin-bottom: 2rem;
      padding: 0;
      background: none;
      box-shadow: none;
      border-radius: 0;
    }

    .header h1 {
      font-size: 2.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: #37352f;
      letter-spacing: -0.02em;
    }

    .header p {
      font-size: 0.875rem;
      color: #787774;
      font-weight: 400;
      margin: 0;
    }

    .control-panel {
      background: #f7f6f3;
      border-radius: 6px;
      padding: 1rem;
      border: 1px solid #e9e7e4;
      margin-bottom: 1rem;
    }

    .control-panel h3 {
      font-size: 0.875rem;
      font-weight: 600;
      color: #37352f;
      margin-bottom: 0.75rem;
      text-align: left;
    }

    .control-buttons {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid #d3d1cb;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      background: #ffffff;
      color: #37352f;
      min-width: auto;
      text-transform: none;
      letter-spacing: 0;
    }

    .btn:hover {
      background: #f7f6f3;
      transform: none;
      box-shadow: none;
    }

    .btn-primary {
      background: #2383e2;
      color: white;
      border-color: #2383e2;
    }

    .btn-primary:hover {
      background: #1a73d1;
      border-color: #1a73d1;
    }

    .btn-danger {
      background: #eb5757;
      color: white;
      border-color: #eb5757;
    }

    .btn-danger:hover {
      background: #d84545;
      border-color: #d84545;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0;
      border-bottom: none;
    }

    .section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: #37352f;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .refresh-btn {
      padding: 0.25rem 0.5rem;
      background: #ffffff;
      color: #37352f;
      border: 1px solid #d3d1cb;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.75rem;
      font-weight: 500;
      transition: all 0.15s ease;
    }

    .refresh-btn:hover {
      background: #f7f6f3;
      transform: none;
      box-shadow: none;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.875rem;
      background: white;
      border: 1px solid #e9e7e4;
      border-radius: 6px;
      overflow: hidden;
    }

    .data-table th {
      background: #f7f6f3;
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      color: #37352f;
      border-bottom: 1px solid #e9e7e4;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    .data-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #f1f0ec;
      vertical-align: top;
      color: #37352f;
    }

    .data-table tr:hover {
      background: #fbfbfa;
    }

    .table-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: 6px;
      border: 1px solid #e9e7e4;
      background: #ffffff;
    }

    .status-badge {
      padding: 0.125rem 0.375rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
      display: inline-block;
    }

    .status-success {
      background: #def7ec;
      color: #03543f;
    }

    .status-error {
      background: #fde8e8;
      color: #9b1c1c;
    }

    .status-info {
      background: #e1effe;
      color: #1e3a8a;
    }

    .logs-section {
      grid-column: 1 / -1;
      background: #ffffff;
      border-radius: 6px;
      padding: 1rem;
      border: 1px solid #e9e7e4;
      margin-top: 1rem;
    }

    .logs-container {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 4px;
      height: 300px;
      overflow-y: auto;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      font-size: 0.8rem;
      line-height: 1.4;
    }

    .log-entry {
      margin-bottom: 0.25rem;
      word-wrap: break-word;
    }

    .log-timestamp {
      color: #888;
      margin-right: 0.5rem;
    }

    .log-level-INFO {
      color: #9cdcfe;
    }

    .log-level-ERROR {
      color: #f48771;
    }

    .log-level-WARNING {
      color: #dcdcaa;
    }

    .log-level-SUCCESS {
      color: #4ec9b0;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: #6c757d;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 0.5rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .screenshot-thumbnail {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .screenshot-thumbnail:hover {
      transform: scale(1.1);
    }

    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 0;
    }

    .stat-card {
      background: #ffffff;
      color: #37352f;
      padding: 1rem;
      border-radius: 6px;
      text-align: center;
      border: 1px solid #e9e7e4;
      transition: all 0.15s ease;
    }

    .stat-card:hover {
      transform: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-color: #d3d1cb;
    }

    .stat-number {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      color: #37352f;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #787774;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      font-weight: 500;
    }

    .status-section {
      background: #ffffff;
      border-radius: 6px;
      padding: 1rem;
      border: 1px solid #e9e7e4;
      margin-bottom: 1rem;
    }

    .status-header {
      text-align: center;
      margin-bottom: 1rem;
    }

    .status-header h3 {
      font-size: 0.875rem;
      font-weight: 600;
      color: #37352f;
      margin-bottom: 0.75rem;
      text-align: left;
    }

    .status-indicators {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      font-size: 0.875rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .status-dot.active {
      background: #00b894;
      animation: pulse 2s infinite;
    }

    .status-dot.inactive {
      background: #e17055;
    }

    .status-dot.warning {
      background: #fdcb6e;
    }

    .status-dot.idle {
      background: #74b9ff;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .progress-section {
      margin-top: 1rem;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      color: #666;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00b894, #00cec9);
      border-radius: 4px;
      transition: width 0.3s ease;
      position: relative;
    }

    .progress-fill.active::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .overview-section {
      background: #ffffff;
      border-radius: 6px;
      padding: 1rem;
      border: 1px solid #e9e7e4;
      margin-bottom: 1rem;
    }

    .overview-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
      align-items: start;
    }

    .view-increases {
      background: #f7f6f3;
      color: #37352f;
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid #e9e7e4;
    }

    .view-increases h4 {
      margin-bottom: 0.75rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: #37352f;
    }

    .increase-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #e9e7e4;
      font-size: 0.875rem;
    }

    .increase-item:last-child {
      border-bottom: none;
    }

    .increase-value {
      font-weight: bold;
      color: #27ae60;
    }

    .increase-value.negative {
      color: #e74c3c;
    }

    .section-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: #3498db;
      color: white;
      border-radius: 50%;
      font-size: 0.8rem;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    /* Toggle Switch Styles */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #e9e7e4;
      transition: 0.2s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.2s;
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    input:checked + .toggle-slider {
      background-color: #2383e2;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }

    /* Modern Card Grid Layout */
    .main-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .grid-item-full {
      grid-column: 1 / -1;
    }
    
    .grid-item-half {
      grid-column: span 1;
    }
    
    .grid-item-third {
      grid-column: span 4;
    }
    
    .grid-item-quarter {
      grid-column: span 3;
    }

    /* Enhanced Analytics Section */
    .analytics-section {
      background: #ffffff;
      border-radius: 6px;
      padding: 1rem;
      border: 1px solid #e9e7e4;
      transition: all 0.15s ease;
      position: relative;
      overflow: hidden;
    }

    .analytics-section:hover {
      transform: none;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-color: #d3d1cb;
    }
    
    .grid-item-third {
      grid-column: span 4;
    }
    
    .grid-item-quarter {
      grid-column: span 3;
    }

    /* Enhanced Loading States */
    .loading {
      text-align: center;
      padding: 2rem;
      color: #6c757d;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading-shimmer 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes loading-shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    @media (max-width: 768px) {      
      .overview-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .control-buttons {
        flex-direction: column;
        align-items: stretch;
      }
      
      .stats-summary {
        grid-template-columns: 1fr;
      }
      
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>LinkrtGOD</h1>
      <p>Developed by Vashishth</p>
    </div>

    <!-- System Status Section -->
    <div class="status-section">
      <div class="status-header">
        <h3>üîÑ System Status</h3>
        <div class="status-indicators">
          <div class="status-indicator">
            <div class="status-dot idle" id="system-status"></div>
            <span id="system-status-text">System: Initializing...</span>
          </div>
        </div>
        <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #666; text-align: center;">
          <span id="current-log">Starting analytics dashboard...</span>
        </div>
      </div>
      <div class="progress-section">
        <div class="progress-label">
          <span id="progress-label">Initializing system...</span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
      <h3 style="margin-bottom: 1rem; color: #2c3e50; text-align: center;">System Controls</h3>
      <div class="control-buttons">
        <button class="btn btn-primary" onclick="launchScrape()">
          Start Tracking
        </button>
        <button class="btn btn-danger" onclick="stopScrape()">
          Stop Tracking
        </button>
      </div>
    </div>

    <!-- Scraping Controls Section -->
    <div class="control-panel">
      <h3 style="margin-bottom: 1rem; color: #2c3e50; text-align: center;">‚öôÔ∏è Scraping Controls</h3>
      <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-weight: 500; color: #2c3e50;">üé≤ Random Intervals:</span>
          <label class="toggle-switch">
            <input type="checkbox" id="random-intervals-toggle" onchange="toggleRandomIntervals()">
            <span class="toggle-slider"></span>
          </label>
          <span id="random-status" style="font-size: 0.875rem; color: #666;">Disabled</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-weight: 500; color: #2c3e50;">‚è±Ô∏è Interval:</span>
          <select id="interval-select" style="padding: 0.375rem 0.5rem; border: 1px solid #d3d1cb; border-radius: 4px; background: white; color: #37352f; font-size: 0.875rem;" onchange="updateInterval()">
            <option value="300000">5 minutes</option>
            <option value="600000" selected>10 minutes</option>
            <option value="900000">15 minutes</option>
            <option value="1800000">30 minutes</option>
            <option value="3600000">1 hour</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Overview Section -->
    <div class="overview-section">
      <div class="overview-grid">
        <div>
          <h3 style="margin-bottom: 1rem; color: #2c3e50;">üìà Overview</h3>
          <div class="stats-summary">
            <div class="stat-card">
              <div class="stat-number" id="overview-total-viewers">0</div>
              <div class="stat-label">Total Profile Views</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="overview-free-viewers">0</div>
              <div class="stat-label">Free Viewers</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="overview-premium-viewers">0</div>
              <div class="stat-label">Premium Viewers</div>
            </div>
          </div>
        </div>
        <div class="view-increases">
          <h4>üìä View Increases</h4>
          <div class="increase-item">
            <span>Today</span>
            <span class="increase-value" id="increase-today">+0</span>
          </div>
          <div class="increase-item">
            <span>Past 
              <select id="hours-dropdown" style="background: rgba(255,255,255,0.9); border: 1px solid #d3d1cb; border-radius: 4px; color: #37352f; padding: 2px 6px; font-size: 0.875rem;" onchange="updatePastHoursData()">
                <option value="1">1</option>
                <option value="3">3</option>
                <option value="6">6</option>
                <option value="12" selected>12</option>
                <option value="24">24</option>
              </select> Hours
            </span>
            <span class="increase-value" id="increase-hours">+0</span>
          </div>
          <div class="increase-item">
            <span>All Time</span>
            <span class="increase-value" id="increase-total">+0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Analytics Grid -->
    <div class="main-grid">
      <!-- Stats Summary -->
      <div class="stats-summary grid-item-full">
        <div class="stat-card">
          <div class="stat-number" id="total-viewers-stat">0</div>
          <div class="stat-label">Total Viewers</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-screenshots-stat">0</div>
          <div class="stat-label">Screenshots</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-daily-records-stat">0</div>
          <div class="stat-label">Daily Records</div>
        </div>
      </div>

      <!-- Viewers Section -->
      <div class="analytics-section grid-item-half">
        <div class="section-header">
          <h3 class="section-title">üë• Viewers Data</h3>
          <button class="refresh-btn" onclick="fetchViewersData()">Refresh</button>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Company</th>
                <th>Date</th>
                <th>Type</th>
              </tr>
            </thead>
            <tbody id="viewers-table-body">
              <tr>
                <td colspan="5" class="loading">
                  <div class="spinner"></div>
                  Loading viewers data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Free Viewers Only Section -->
      <div class="analytics-section grid-item-half">
        <div class="section-header">
          <h3 class="section-title">üÜì Free Viewers Only</h3>
          <button class="refresh-btn" onclick="fetchFreeViewersData()">Refresh</button>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Company</th>
                <th>Date</th>
                <th>Headline</th>
              </tr>
            </thead>
            <tbody id="free-viewers-table-body">
              <tr>
                <td colspan="5" class="loading">
                  <div class="spinner"></div>
                  Loading free viewers...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Daily Totals Section -->
      <div class="analytics-section grid-item-half">
        <div class="section-header">
          <h3 class="section-title">üìÖ Daily Totals</h3>
          <button class="refresh-btn" onclick="fetchDailyTotalsData()">Refresh</button>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Date</th>
                <th>Total Views</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="daily-totals-table-body">
              <tr>
                <td colspan="4" class="loading">
                  <div class="spinner"></div>
                  Loading daily totals...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Screenshots Section -->
      <div class="analytics-section grid-item-half">
        <div class="section-header">
          <h3 class="section-title">üì∏ Screenshots</h3>
          <button class="refresh-btn" onclick="fetchScreenshotsData()">Refresh</button>
        </div>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Preview</th>
                <th>Filename</th>
                <th>Date</th>
                <th>Size</th>
              </tr>
            </thead>
            <tbody id="screenshots-table-body">
              <tr>
                <td colspan="5" class="loading">
                  <div class="spinner"></div>
                  Loading screenshots...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Live Logs Section -->
      <div class="logs-section grid-item-full">
        <div class="section-header">
          <h3 class="section-title">üìù Live System Logs</h3>
          <button class="refresh-btn" onclick="clearLogs()">Clear Logs</button>
        </div>
        <div class="logs-container" id="logs-container">
          <div class="log-entry">
            <span class="log-timestamp">[Starting...]</span>
            <span class="log-level-INFO">Analytics dashboard initialized</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getFirestore, collection, getDocs, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAPX-69qLt2Kwc_6rjMzymUUXhtPwSxsHk",
      authDomain: "linkrtdb.firebaseapp.com",
      projectId: "linkrtdb",
      storageBucket: "linkrtdb.firebasestorage.app",
      messagingSenderId: "250414480081",
      appId: "1:250414480081:web:79de7428b63923578063f0",
      measurementId: "G-EZ2XERVTK7"
    };    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Make Firebase available globally
    window.db = db;
    window.collection = collection;
    window.getDocs = getDocs;
    window.query = query;
    window.orderBy = orderBy;
    window.limit = limit;

    console.log('Firebase initialized successfully');
    addLog('SYSTEM', 'Firebase connection established', 'SUCCESS');
  </script>

  <script>
    // Backend URL configuration
    const BACKEND_URL = 'http://localhost:3000';
    
    // Status management system
    class StatusManager {
      constructor() {
        this.currentProgress = 0;
        this.maxProgress = 100;
        this.isActive = false;
      }

      updateSystemStatus(status, text) {
        const statusDot = document.getElementById('system-status');
        const statusText = document.getElementById('system-status-text');
        
        if (statusDot && statusText) {
          statusDot.className = `status-dot ${status}`;
          statusText.textContent = text;
        }
      }

      updateCurrentLog(message) {
        const currentLog = document.getElementById('current-log');
        if (currentLog) {
          currentLog.textContent = message;
        }
      }

      updateProgress(progress, label = null) {
        this.currentProgress = Math.max(0, Math.min(100, progress));
        
        const progressFill = document.getElementById('progress-fill');
        const progressPercent = document.getElementById('progress-percent');
        const progressLabel = document.getElementById('progress-label');
        
        if (progressFill) {
          progressFill.style.width = `${this.currentProgress}%`;
          if (this.currentProgress > 0 && this.currentProgress < 100) {
            progressFill.classList.add('active');
          } else {
            progressFill.classList.remove('active');
          }
        }
        
        if (progressPercent) {
          progressPercent.textContent = `${Math.round(this.currentProgress)}%`;
        }
        
        if (progressLabel && label) {
          progressLabel.textContent = label;
        }
      }

      setScrapingProgress(status) {
        switch(status) {
          case 'starting':
            this.updateSystemStatus('warning', 'System: Starting scraper...');
            this.updateCurrentLog('Scraper is starting up...');
            this.updateProgress(10, 'Starting scraper...');
            break;
          case 'running':
            this.updateSystemStatus('active', 'System: Scraper running');
            this.updateCurrentLog('Scraper is actively collecting data...');
            this.updateProgress(50, 'Scraping in progress...');
            break;
          case 'stopped':
            this.updateSystemStatus('idle', 'System: Scraper stopped');
            this.updateCurrentLog('Scraper has been stopped');
            this.updateProgress(0, 'Scraper idle');
            break;
          case 'error':
            this.updateSystemStatus('inactive', 'System: Scraper error');
            this.updateCurrentLog('Scraper encountered an error');
            this.updateProgress(0, 'Scraper error');
            break;
        }
      }
    }

    // Initialize status manager
    const statusManager = new StatusManager();

    // Check server status
    async function checkServerStatus() {
      try {
        const response = await fetch(`${BACKEND_URL}/api/logs`, { 
          method: 'GET',
          signal: AbortSignal.timeout(5000)
        });
        
        if (response.ok) {
          statusManager.updateSystemStatus('active', 'System: Online & Connected');
          statusManager.updateCurrentLog('All systems operational');
          return true;
        } else {
          statusManager.updateSystemStatus('warning', 'System: Connection issues');
          statusManager.updateCurrentLog('Server connection issues detected');
          return false;
        }
      } catch (error) {
        statusManager.updateSystemStatus('inactive', 'System: Server offline');
        statusManager.updateCurrentLog('Unable to connect to server');
        return false;
      }
    }

    // Update overview stats (optimized)
    async function updateOverviewStats() {
      try {
        // Quick count queries
        const [dailySnapshot, viewersSnapshot] = await Promise.all([
          getDocs(query(collection(db, "daily_totals"), limit(1))),
          getDocs(query(collection(db, "viewers"), limit(100)))
        ]);
        
        // Get total viewers from latest daily record
        let totalViewers = 0;
        if (!dailySnapshot.empty) {
          totalViewers = dailySnapshot.docs[0].data().total || 0;
        }

        // Quick count of free vs premium
        let freeViewers = 0, premiumViewers = 0;
        viewersSnapshot.forEach(doc => {
          const data = doc.data();
          const isFreeViewer = data.name && data.name.length > 10 && 
            !data.name.includes('Someone at') && !data.name.includes('LinkedIn Member');
          
          if (isFreeViewer) freeViewers++;
          else premiumViewers++;
        });

        // Update display quickly
        document.getElementById('overview-total-viewers').textContent = totalViewers.toLocaleString();
        document.getElementById('overview-free-viewers').textContent = freeViewers.toLocaleString();
        document.getElementById('overview-premium-viewers').textContent = premiumViewers.toLocaleString();

        // Simple view increases (using total viewers for now)
        document.getElementById('increase-today').textContent = `+${totalViewers}`;
        document.getElementById('increase-hours').textContent = `+${Math.floor(totalViewers * 0.3)}`; // Approximate for past hours
        document.getElementById('increase-total').textContent = `+${totalViewers}`;

      } catch (error) {
        console.error('Error updating overview:', error);
      }
    }
    
    // Live logger system
    class LiveLogger {
      constructor(containerId) {
        this.container = document.getElementById(containerId);
        this.maxLogs = 100;
      }

      addLog(source, message, level = 'INFO', details = null) {
        const timestamp = new Date().toLocaleTimeString('en-IN', {
          timeZone: 'Asia/Kolkata',
          hour12: false
        });
        
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        
        let logText = `[${timestamp}] [${source}] ${message}`;
        if (details) {
          logText += ` - ${JSON.stringify(details)}`;
        }
        
        logEntry.innerHTML = `
          <span class="log-timestamp">[${timestamp}]</span>
          <span class="log-level-${level}">[${source}] ${message}</span>
          ${details ? `<br><span style="color: #888; margin-left: 4rem;">${JSON.stringify(details)}</span>` : ''}
        `;
        
        this.container.appendChild(logEntry);
        
        // Keep only last 100 logs
        while (this.container.children.length > this.maxLogs) {
          this.container.removeChild(this.container.firstChild);
        }
        
        // Auto-scroll to bottom
        this.container.scrollTop = this.container.scrollHeight;
      }

      logError(source, error) {
        this.addLog(source, `Error: ${error.message}`, 'ERROR', {
          stack: error.stack?.split('\n')[0]
        });
      }

      clear() {
        this.container.innerHTML = '';
        this.addLog('SYSTEM', 'Logs cleared', 'INFO');
      }
    }

    // Initialize live logger
    const liveLogger = new LiveLogger('logs-container');

    // Global log function
    function addLog(source, message, level = 'INFO', details = null) {
      liveLogger.addLog(source, message, level, details);
      // Also update current log status
      statusManager.updateCurrentLog(`${source}: ${message}`);
    }

    // Clear logs function
    function clearLogs() {
      liveLogger.clear();
    }

    // Launch scrape function
    async function launchScrape() {
      try {
        addLog('USER', 'Starting scraping process...', 'INFO');
        statusManager.setScrapingProgress('starting');
        
        const response = await fetch(`${BACKEND_URL}/api/scrape`, {
          method: 'POST'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          statusManager.setScrapingProgress('running');
          addLog('SCRAPER', 'Scraping started successfully', 'SUCCESS', {
            status: result.status || 'Started'
          });
        } else {
          statusManager.setScrapingProgress('error');
          addLog('SCRAPER', 'Failed to start scraping', 'ERROR', {
            error: result.error || 'Unknown error'
          });
        }
      } catch (error) {
        statusManager.setScrapingProgress('error');
        liveLogger.logError('SCRAPER', error);
      }
    }

    // Stop scrape function
    async function stopScrape() {
      try {
        addLog('USER', 'Stopping scraping process...', 'INFO');
        statusManager.setScrapingProgress('stopped');
        
        const response = await fetch(`${BACKEND_URL}/api/stop`, {
          method: 'POST'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          statusManager.setScrapingProgress('stopped');
          addLog('SCRAPER', 'Scraping stopped successfully', 'SUCCESS', {
            status: result.status || 'Stopped'
          });
        } else {
          statusManager.setScrapingProgress('error');
          addLog('SCRAPER', 'Failed to stop scraping', 'ERROR', {
            error: result.error || 'Unknown error'
          });
        }
      } catch (error) {
        statusManager.setScrapingProgress('error');
        liveLogger.logError('SCRAPER', error);
      }
    }

    // Fetch viewers data from Firestore (optimized)
    async function fetchViewersData() {
      try {
        addLog('DB', 'Fetching viewers data...', 'INFO');
        
        const tbody = document.getElementById('viewers-table-body');
        tbody.innerHTML = '<tr><td colspan="5" class="loading"><div class="spinner"></div>Loading viewers...</td></tr>';
        
        // Use limit query for better performance
        const viewersRef = collection(db, "viewers");
        const q = query(viewersRef, limit(50));
        const snapshot = await getDocs(q);
        
        tbody.innerHTML = '';
        
        if (snapshot.empty) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <div>üì≠ No viewer data found</div>
                <small>Run the scraper to collect viewer data</small>
              </td>
            </tr>
          `;
          addLog('DB', 'No viewer records found', 'WARNING');
          return;
        }
        
        // Process documents directly without full conversion
        let rowCount = 0;
        snapshot.forEach(doc => {
          const data = doc.data();
          rowCount++;
          
          // Quick name cleanup
          let displayName = data.name || 'Anonymous';
          if (displayName.includes("'s profile")) {
            displayName = displayName.replace(/View\s+(.+)'s profile/, '$1').trim();
          }
          
          // Quick viewer type check
          const isFreeViewer = data.name && data.name.length > 10 && 
            !data.name.includes('Someone at') && !data.name.includes('LinkedIn Member');
          
          const viewerType = isFreeViewer ? 
            '<span class="status-badge status-success">Free</span>' : 
            '<span class="status-badge status-info">Premium</span>';
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td style="width: 50px; text-align: center;"><strong>${rowCount}</strong></td>
            <td style="max-width: 200px; word-wrap: break-word;">
              <strong>${displayName}</strong>
              ${data.headline ? `<br><small style="color: #666;">${data.headline.substring(0, 50)}${data.headline.length > 50 ? '...' : ''}</small>` : ''}
            </td>
            <td>${data.company || 'Not specified'}</td>
            <td style="white-space: nowrap;">${data.timestamp || 'Unknown'}</td>
            <td>${viewerType}</td>
          `;
          tbody.appendChild(row);
        });
        
        addLog('DB', `Viewers loaded: ${rowCount} records`, 'SUCCESS');
        
      } catch (error) {
        addLog('DB', `Error fetching viewers: ${error.message}`, 'ERROR');
        const tbody = document.getElementById('viewers-table-body');
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="empty-state">
              <div style="color: #dc3545;">‚ùå Error loading data</div>
              <small>${error.message}</small>
            </td>
          </tr>
        `;
      }
    }

    // Fetch free viewers only data from Firestore (optimized)
    async function fetchFreeViewersData() {
      try {
        addLog('DB', 'Fetching free viewers...', 'INFO');
        
        const tbody = document.getElementById('free-viewers-table-body');
        tbody.innerHTML = '<tr><td colspan="5" class="loading"><div class="spinner"></div>Loading free viewers...</td></tr>';
        
        // Use limit query for better performance
        const viewersRef = collection(db, "viewers");
        const q = query(viewersRef, limit(100)); // Get more to filter
        const snapshot = await getDocs(q);
        
        tbody.innerHTML = '';
        
        if (snapshot.empty) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <div>üì≠ No viewer data found</div>
                <small>Run the scraper to collect viewer data</small>
              </td>
            </tr>
          `;
          return;
        }
        
        // Filter free viewers directly without full array conversion
        let rowCount = 0;
        const seenNames = new Set();
        
        snapshot.forEach(doc => {
          const data = doc.data();
          
          // Quick free viewer check
          const isFreeViewer = data.name && data.name.length > 10 && 
            !data.name.includes('Someone at') && !data.name.includes('LinkedIn Member');
          
          if (isFreeViewer && rowCount < 50) { // Limit display
            let displayName = data.name;
            if (displayName.includes("'s profile")) {
              displayName = displayName.replace(/View\s+(.+)'s profile/, '$1').trim();
            }
            
            if (!seenNames.has(displayName)) {
              seenNames.add(displayName);
              rowCount++;
              
              const row = document.createElement('tr');
              row.innerHTML = `
                <td style="width: 50px; text-align: center;"><strong>${rowCount}</strong></td>
                <td style="max-width: 200px; word-wrap: break-word;">
                  <strong>${displayName}</strong>
                </td>
                <td>${data.company || 'Not specified'}</td>
                <td style="white-space: nowrap;">${data.timestamp || 'Unknown'}</td>
                <td style="max-width: 300px; word-wrap: break-word;">
                  ${data.headline ? `<small style="color: #666;">${data.headline.substring(0, 80)}${data.headline.length > 80 ? '...' : ''}</small>` : 'No headline'}
                </td>
              `;
              tbody.appendChild(row);
            }
          }
        });
        
        if (rowCount === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <div>üîç No free viewers found</div>
                <small>Only premium/anonymous viewers detected</small>
              </td>
            </tr>
          `;
        }
        
        addLog('DB', `Free viewers loaded: ${rowCount} unique viewers`, 'SUCCESS');
        
      } catch (error) {
        addLog('DB', `Error fetching free viewers: ${error.message}`, 'ERROR');
        const tbody = document.getElementById('free-viewers-table-body');
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="empty-state">
              <div style="color: #dc3545;">‚ùå Error loading data</div>
              <small>${error.message}</small>
            </td>
          </tr>
        `;
      }
    }

    // Update total viewers stat (optimized)
    async function updateTotalViewersStat() {
      try {
        const dailyTotalsRef = collection(db, "daily_totals");
        const q = query(dailyTotalsRef, limit(1)); // Just get one recent record
        const snapshot = await getDocs(q);
        
        let totalViewers = 0;
        if (!snapshot.empty) {
          const doc = snapshot.docs[0];
          totalViewers = doc.data().total || 0;
        }
        
        document.getElementById('total-viewers-stat').textContent = totalViewers.toLocaleString();
        
      } catch (error) {
        document.getElementById('total-viewers-stat').textContent = '0';
      }
    }

    // Fetch daily totals data (optimized)
    async function fetchDailyTotalsData() {
      try {
        addLog('DB', 'Fetching daily totals...', 'INFO');
        
        const tbody = document.getElementById('daily-totals-table-body');
        tbody.innerHTML = '<tr><td colspan="4" class="loading"><div class="spinner"></div>Loading daily totals...</td></tr>';
        
        // Use limit query for better performance
        const dailyTotalsRef = collection(db, "daily_totals");
        const q = query(dailyTotalsRef, limit(30));
        const snapshot = await getDocs(q);
        
        tbody.innerHTML = '';
        
        if (snapshot.empty) {
          tbody.innerHTML = `
            <tr>
              <td colspan="4" class="empty-state">
                <div>üìÖ No daily records found</div>
                <small>Data will appear after scraping</small>
              </td>
            </tr>
          `;
          return;
        }
        
        // Process documents directly
        let rowCount = 0;
        snapshot.forEach(doc => {
          const data = doc.data();
          rowCount++;
          
          // Simple status based on total
          let statusBadge = '<span class="status-badge status-info">Normal</span>';
          if (data.total > 1000) {
            statusBadge = '<span class="status-badge status-success">High Activity</span>';
          } else if (data.total === 0) {
            statusBadge = '<span class="status-badge status-error">No Views</span>';
          }
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td style="width: 50px; text-align: center;"><strong>${rowCount}</strong></td>
            <td>${data.date || 'Unknown'}</td>
            <td><strong>${data.total || 0}</strong></td>
            <td>${statusBadge}</td>
          `;
          tbody.appendChild(row);
        });
        
        // Update stats
        document.getElementById('total-daily-records-stat').textContent = snapshot.size;
        
        addLog('DB', `Daily totals loaded: ${rowCount} records`, 'SUCCESS');
        
      } catch (error) {
        addLog('DB', `Error fetching daily totals: ${error.message}`, 'ERROR');
        const tbody = document.getElementById('daily-totals-table-body');
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="empty-state">
              <div style="color: #dc3545;">‚ùå Error loading data</div>
              <small>${error.message}</small>
            </td>
          </tr>
        `;
      }
    }

    // Fetch screenshots data (optimized)
    async function fetchScreenshotsData() {
      try {
        addLog('DB', 'Fetching screenshots...', 'INFO');
        
        const tbody = document.getElementById('screenshots-table-body');
        tbody.innerHTML = '<tr><td colspan="5" class="loading"><div class="spinner"></div>Loading screenshots...</td></tr>';
        
        // Use limit query for better performance
        const screenshotsRef = collection(db, "screenshots");
        const q = query(screenshotsRef, limit(20));
        const snapshot = await getDocs(q);
        
        tbody.innerHTML = '';
        
        if (snapshot.empty) {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="empty-state">
                <div>üì∏ No screenshots found</div>
                <small>Screenshots will appear after scraping</small>
              </td>
            </tr>
          `;
          return;
        }
        
        // Process documents directly
        let rowCount = 0;
        snapshot.forEach(doc => {
          const data = doc.data();
          rowCount++;
          
          // Format file size quickly
          let fileSize = 'Unknown';
          if (data.size) {
            const bytes = parseInt(data.size);
            if (bytes < 1048576) { // Less than 1MB
              fileSize = Math.round(bytes / 1024) + ' KB';
            } else {
              fileSize = Math.round(bytes / 1048576) + ' MB';
            }
          }
          
          // Simple thumbnail
          let thumbnail = '<div style="width: 50px; height: 50px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #666;">üì∏</div>';
          if (data.localPath) {
            const imagePath = data.localPath.startsWith('/') ? data.localPath.substring(1) : data.localPath;
            thumbnail = `<img src="${imagePath}" class="screenshot-thumbnail" alt="Screenshot" onclick="window.open('${imagePath}', '_blank')" onerror="this.style.display='none';">`;
          }
          
          const row = document.createElement('tr');
          row.innerHTML = `
            <td style="width: 50px; text-align: center;"><strong>${rowCount}</strong></td>
            <td>${thumbnail}</td>
            <td style="max-width: 200px; word-wrap: break-word;">
              <strong>${data.filename || 'Unknown'}</strong>
              ${data.totalViewers ? `<br><small style="color: #666;">${data.totalViewers} viewers</small>` : ''}
            </td>
            <td style="white-space: nowrap;">${data.timestamp || data.istTimestamp || 'Unknown'}</td>
            <td>${fileSize}</td>
          `;
          tbody.appendChild(row);
        });
        
        // Update stats
        document.getElementById('total-screenshots-stat').textContent = snapshot.size;
        
        addLog('DB', `Screenshots loaded: ${rowCount} records`, 'SUCCESS');
        
      } catch (error) {
        addLog('DB', `Error fetching screenshots: ${error.message}`, 'ERROR');
        const tbody = document.getElementById('screenshots-table-body');
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="empty-state">
              <div style="color: #dc3545;">‚ùå Error loading data</div>
              <small>${error.message}</small>
            </td>
          </tr>
        `;
      }
    }

    // Auto-refresh logs from backend
    async function fetchBackendLogs() {
      try {
        const response = await fetch(`${BACKEND_URL}/api/logs`);
        if (response.ok) {
          const data = await response.json();
          if (data.logs && data.logs.length > 0) {
            // Clear existing logs and add backend logs
            const container = document.getElementById('logs-container');
            container.innerHTML = '';
            
            data.logs.reverse().forEach(logEntry => {
              const div = document.createElement('div');
              div.className = 'log-entry';
              
              // Parse log entry to extract timestamp, level, and message
              const match = logEntry.match(/(\d+:\d+:\d+\s*(?:AM|PM)?) \[(\w+)\] (.+)/);
              if (match) {
                const [, timestamp, level, message] = match;
                div.innerHTML = `
                  <span class="log-timestamp">[${timestamp}]</span>
                  <span class="log-level-${level}">[${level}] ${message}</span>
                `;
              } else {
                div.innerHTML = `<span class="log-level-INFO">${logEntry}</span>`;
              }
              
              container.appendChild(div);
            });
            
            // Auto-scroll to bottom
            container.scrollTop = container.scrollHeight;
          }
        }
      } catch (error) {
        // Only log error if it's the first time
        if (!window.logFetchErrorLogged) {
          addLog('SYSTEM', 'Could not fetch backend logs (server may be offline)', 'WARNING');
          window.logFetchErrorLogged = true;
        }
      }
    }

    // Initialize data loading (optimized)
    async function initializeAnalytics() {
      addLog('SYSTEM', 'Starting analytics...', 'INFO');
      statusManager.updateSystemStatus('warning', 'System: Loading...');
      statusManager.updateProgress(20, 'Initializing...');
      
      try {
        // Load data in sequence to avoid overwhelming Firestore
        statusManager.updateProgress(40, 'Loading overview...');
        await updateOverviewStats();
        
        statusManager.updateProgress(60, 'Loading tables...');
        // Load tables one by one instead of all at once
        await fetchViewersData();
        await fetchFreeViewersData();
        await fetchDailyTotalsData();
        await fetchScreenshotsData();
        
        // Update total viewers stat
        await updateTotalViewersStat();
        
        statusManager.updateSystemStatus('active', 'System: Ready');
        statusManager.updateProgress(100, 'Analytics ready');
        
        addLog('SYSTEM', 'Analytics loaded successfully', 'SUCCESS');
        
        // Reset progress after delay
        setTimeout(() => {
          statusManager.updateProgress(0, 'System ready');
        }, 2000);
        
      } catch (error) {
        statusManager.updateSystemStatus('inactive', 'System: Error');
        addLog('SYSTEM', `Error loading analytics: ${error.message}`, 'ERROR');
      }
      
      // Check server status
      await checkServerStatus();
    }

    // Auto-refresh functionality (optimized)
    function startAutoRefresh() {
      // Reduced refresh frequency to avoid overwhelming Firestore
      setInterval(() => {
        addLog('SYSTEM', 'Auto-refreshing...', 'INFO');
        updateOverviewStats(); // Only refresh overview stats automatically
      }, 300000); // Every 5 minutes instead of 2 minutes
      
      // Check server status every minute
      setInterval(() => {
        checkServerStatus();
      }, 60000);
      
      // Reduced log fetch frequency
      setInterval(fetchBackendLogs, 10000); // Every 10 seconds instead of 5
      
      // Initial log fetch
      setTimeout(fetchBackendLogs, 5000);
    }

    // Initialize when DOM is loaded (optimized)
    document.addEventListener('DOMContentLoaded', () => {
      // Reduce initial delay for faster loading
      setTimeout(() => {
        initializeAnalytics();
        startAutoRefresh();
      }, 1000); // Reduced from 2000ms to 1000ms
    });

    // Make functions globally available
    window.launchScrape = launchScrape;
    window.stopScrape = stopScrape;
    window.fetchViewersData = fetchViewersData;
    window.fetchFreeViewersData = fetchFreeViewersData;
    window.fetchDailyTotalsData = fetchDailyTotalsData;
    window.fetchScreenshotsData = fetchScreenshotsData;
    window.updateTotalViewersStat = updateTotalViewersStat;
    window.updateOverviewStats = updateOverviewStats;
    window.checkServerStatus = checkServerStatus;
    window.statusManager = statusManager;
    window.clearLogs = clearLogs;
    window.addLog = addLog;

    // Update Past Hours Data function
    async function updatePastHoursData() {
      const selectedHours = document.getElementById('hours-dropdown').value;
      try {
        // Get viewers data and calculate for selected hours
        const viewersRef = collection(db, "viewers");
        const snapshot = await getDocs(query(viewersRef, limit(200)));
        
        let pastHoursCount = 0;
        const now = new Date();
        const hoursAgo = new Date(now.getTime() - (selectedHours * 60 * 60 * 1000));
        
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.scraped_at && data.scraped_at.toDate) {
            const scrapedDate = data.scraped_at.toDate();
            if (scrapedDate >= hoursAgo) {
              pastHoursCount++;
            }
          }
        });
        
        document.getElementById('increase-hours').textContent = `+${pastHoursCount}`;
        addLog('SYSTEM', `Updated past ${selectedHours} hours data: +${pastHoursCount}`, 'INFO');
      } catch (error) {
        console.error('Error updating past hours data:', error);
        // Fallback to approximate calculation
        const totalViewers = parseInt(document.getElementById('overview-total-viewers').textContent.replace(/,/g, '')) || 0;
        const approximateCount = Math.floor(totalViewers * (selectedHours / 24) * 0.3);
        document.getElementById('increase-hours').textContent = `+${approximateCount}`;
      }
    }

    // Random Intervals and Scraping Controls
    let randomIntervalsEnabled = false;
    let currentInterval = 600000; // 10 minutes default

    function toggleRandomIntervals() {
      const toggle = document.getElementById('random-intervals-toggle');
      const status = document.getElementById('random-status');
      
      randomIntervalsEnabled = toggle.checked;
      status.textContent = randomIntervalsEnabled ? 'Enabled' : 'Disabled';
      status.style.color = randomIntervalsEnabled ? '#4caf50' : '#666';
      
      // Send to backend
      fetch(`${BACKEND_URL}/api/config`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          randomIntervals: randomIntervalsEnabled,
          interval: currentInterval 
        })
      }).then(response => {
        if (response.ok) {
          addLog('CONFIG', `Random intervals ${randomIntervalsEnabled ? 'enabled' : 'disabled'}`, 'SUCCESS');
        }
      }).catch(error => {
        addLog('CONFIG', `Failed to update random intervals: ${error.message}`, 'ERROR');
      });
    }

    function updateInterval() {
      const select = document.getElementById('interval-select');
      currentInterval = parseInt(select.value);
      
      // Send to backend
      fetch(`${BACKEND_URL}/api/config`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          randomIntervals: randomIntervalsEnabled,
          interval: currentInterval 
        })
      }).then(response => {
        if (response.ok) {
          const minutes = currentInterval / 60000;
          addLog('CONFIG', `Scraping interval updated to ${minutes} minutes`, 'SUCCESS');
        }
      }).catch(error => {
        addLog('CONFIG', `Failed to update interval: ${error.message}`, 'ERROR');
      });
    }

    // Make new functions globally available
    window.updatePastHoursData = updatePastHoursData;
    window.toggleRandomIntervals = toggleRandomIntervals;
    window.updateInterval = updateInterval;
  </script>
</body>
</html>
